# TicTacToe Online

[![Build Status](https://travis-ci.org/SergiiVolodkoWorking/TicTacToeOnline.svg?branch=master)](https://travis-ci.org/SergiiVolodkoWorking/TicTacToeOnline)

### Latest playable version: https://tictactoe-elixir-online.herokuapp.com
![image](https://user-images.githubusercontent.com/54677730/66420899-bdfdc280-e9fe-11e9-87c5-c31a295d0224.png)

This project implements TicTacToe as a client-server application with backend made on Elixir utilizing it's Phoenix web framework. Which fronted is made on RaectJS and it's React-Redux package.

## Application run
To start the game:
  * Navigate to the project's folder via terminal.
  * Install dependencies with `mix deps.get`
  * Install Node.js dependencies with `npm --prefix assets install`
  * Start Phoenix endpoint with `mix phx.server`
 
You should see something like this in your terminal
![image](https://user-images.githubusercontent.com/54677730/66423755-3915a780-ea04-11e9-90e0-c317e2934f1a.png)

### The game is running, visit [`localhost:4000`](http://localhost:4000) from your browser to play.

# Solution structure
The folder structure of this project is dictated by 2 major factors:
1. Our deployment server of choice is Heroku. It demands phoenix application structure be in the root folder.
2. Phoenix framework by default creates a folder structure that we see in the project root.
-- `lib` folder is the folder of our server code
-- `assets` - the folder with our client's code
-- other folders
--- `priv` - auto-generated by Phoenix serving it's needs. No changes there
--- `config` - contains configurations 
3. `test` - place for server unit and integration tests
4. `tests_e2e` - place for end-to-end tests. End-to-end tests are implemented as screenshot testing using Cypress.io framework. This framework also demands certain structure of the folders of our end-to-end tests directory.

# Architecture
The solution is a client-server application.

with read and write separated and 2-ways communication implemented via polling.

![image](https://user-images.githubusercontent.com/54677730/66419720-7aa25480-e9fc-11e9-8736-f2efa8b4219e.png)

More detailed page:




A bit more about research outcomes in technology stack chapter of wiki:


## Server

### API
| Endpoint | Request | Response |
|---|---|---|
| /start_game | POST `{ game_id: new_id }` | 200 Json with `game_id` and `board` of newly created round |
| /game/{game_id} | GET | 200 Json with current round complete state |
| /make_move/{game_id}| PUT <br/>`{ taken_space: player's move space index }`| 200 Json with `game_id` | 

### Initial idea for multiplayer
![image](https://user-images.githubusercontent.com/54677730/66429775-a9c2c100-ea10-11e9-9b27-494ff7bcfb3b.png)
Playing swapping players and applying this same logic

### Current make move implementation
Due to bot's logic getting exectuted differently then PvP logic.
Actually, it's getting executed together player's move is applied.
Current implementation at the moment looking differently. But it has a room to be shrinked to the previous scheme.
![image](https://user-images.githubusercontent.com/54677730/66430102-5309b700-ea11-11e9-9c2f-67c57c13ecbc.png)



## Client
Client FSM seems to be a bit complicated because it serves 2 functions:
- Manage UI state
- Manage Game state

In particular this complexity is in Waiting Result state.
During which app starts polling round state data from server.

This is a UI-level state that became a part of pure game-related State Machine.

![image](https://user-images.githubusercontent.com/54677730/66429690-7aac4f80-ea10-11e9-87ac-d04dee16f634.png)

## Testing
![image](https://user-images.githubusercontent.com/54677730/66413271-fa292700-e9ee-11e9-96d2-5b8103baa653.png)


Server

Routing is defined in /tictactoe_web/router.ex
So in case of adding new endpoints, this file has to be extended.

Unit and Integration tests
To run server tests:
  * Install dependencies with `mix deps.get`
  * Start Phoenix endpoint with `mix test`

Client
End-to-end scenarios
Running client tests is a bit more tricky.
Can be done 2 ways.
1. Download cypress.io
-- Open test_e2e folder in project from cypress application
-- Run all tests
2. Run via terminal
-- In first terminal instance start the application as it is described in Application run section
-- Open second terminal instance and:
--- Navigate to `test_e2e` folder of the project
--- Install required dependencies `npm install`
--- Execute tests `npx cypress run`

## Deployment pipeline
Heroku
`elixir_buildpack.config`

Travis
`.travis.yml` and `upload_screenshots.sh`



## Learn more

  * Official website: http://www.phoenixframework.org/
  * Guides: https://hexdocs.pm/phoenix/overview.html
  * Docs: https://hexdocs.pm/phoenix
